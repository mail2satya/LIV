- name: Deploy to SAP BTP
  env:
    CF_API: ${{ secrets.CF_API }}
    CF_ORG: ${{ secrets.CF_ORG }}
    CF_SPACE: ${{ secrets.CF_SPACE }}
    CF_USERNAME: ${{ secrets.CF_USERNAME }}
    CF_PASSWORD: ${{ secrets.CF_PASSWORD }}
  run: |
    cf login -a $CF_API -u "$CF_USERNAME" -p "$CF_PASSWORD" -o $CF_ORG -s $CF_SPACE
    
    # Create service if it doesn't exist
    if ! cf service liv-db > /dev/null 2>&1; then
      cf create-service hana hdi-shared liv-db
    fi
    
    # Deploy application
    cf push liv-device-management \
      --buildpack nodejs_buildpack \
      -m 512M \
      -k 512M \
      --no-start
    
    # Bind service and start application
    cf bind-service liv-device-management liv-db
    cf restart liv-device-management